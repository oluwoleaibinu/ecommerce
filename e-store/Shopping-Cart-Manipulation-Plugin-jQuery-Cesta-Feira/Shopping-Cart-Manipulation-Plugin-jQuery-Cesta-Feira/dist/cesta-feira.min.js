!function(e,t){"use strict";function a(t){t.preventDefault();var a=e.CestaFeira(),r=e(t.currentTarget),s=r.find("[data-cesta-feira-submit]"),u=r.find("[data-cesta-feira-item-id]");s.length||(s=r.find("input[type=submit], button").first());var d,f=e.extend({},e.jStorage.get(o)),c=i(r);u.val()in f?(d="updated",a.defaults.onItemUpdated(c)):(d="added",a.defaults.onItemAdded(c)),f[u.val()]=c,e.jStorage.set(o,f),n(),r.trigger("cesta-feira-item-"+d),a.defaults.debug}function i(t){var a={},i=t.find("[data-cesta-feira-attribute]").serializeArray();return e.each(i,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a}function n(){var t=l.find(".cesta-feira__num-items");if(jQuery.isEmptyObject(s()))return void t.remove();e.each(l,function(t,a){var i=e(this).find(".cesta-feira__num-items");i.length||(i=e('<span class="cesta-feira__num-items" />'),e(this).append(i)),i.html(r())})}function r(){return Object.keys(e.jStorage.get(o)).length}function s(){return e.jStorage.get(o)}function u(t){var a=s(),i=e.CestaFeira();return t in a?(delete a[t],e.jStorage.flush(),e.jStorage.set(o,a),c.trigger("cesta-feira-item-deleted"),i.defaults.debug,n(),!0):(i.defaults.debug,!1)}function d(){var t=e.CestaFeira();return e.jStorage.flush()?(n(),t.defaults.debug,c.trigger("cesta-feira-clear-basket"),!0):(t.defaults.debug,!1)}function f(t){return m||(this.defaults=e.extend({},g,t),m=this,this.init()),m}if(!e.jStorage.storageAvailable())throw"localStorage is not available";var c=e(t),o="cesta-feira-items",l=e("[data-cesta-feira-items-count]"),m=null,g={debug:!1,onItemAdded:function(e){},onItemUpdated:function(e){}};e.extend(f.prototype,{init:function(){e.CestaFeira().defaults.debug,n(),c.on("submit","form[data-cesta-feira-form]",a),c.on("click","[data-cesta-feira-clear-basket]",function(e){e.preventDefault(),d()}),c.on("click","[data-cesta-feira-delete-item]",function(t){t.preventDefault(),u(e(this).data("cesta-feira-delete-item"))})},updateCount:n,getNumItems:r,getItems:s,removeItem:function(e){return u(e)},clearBasket:d}),e.extend({CestaFeira:function(e){return new f(e)}})}(jQuery,document);